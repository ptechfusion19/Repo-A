# n8n Node Updates for SEO Performance Report

## 1. Generate Prompt Node
Use the code from `GeneratePrompt_Updated.js`

---

## 2. Convert To Markdown Node

Replace the entire JavaScript code with:

```javascript
// Convert LLM output to Markdown file
const markdown = $input.first().json.text;
const promptData = $('Generate Prompt').first().json;
const website = promptData.targetWebsite || 'website';
const dateFrom = promptData.dateFrom || '';
const dateTo = promptData.dateTo || '';
const reportPeriod = promptData.reportPeriod || '';

// Create clean filename with date range
const cleanWebsite = website.replace(/[^a-zA-Z0-9]/g, '_').replace(/_+/g, '_');
const cleanDateFrom = dateFrom.replace(/-/g, '');
const cleanDateTo = dateTo.replace(/-/g, '');
const filename = `SEO_Performance_Report_${cleanWebsite}_${cleanDateFrom}_to_${cleanDateTo}.md`;

// Convert markdown text to base64 for binary
const base64Content = Buffer.from(markdown, 'utf8').toString('base64');

return {
  json: {
    filename: filename,
    targetWebsite: website,
    dateFrom: dateFrom,
    dateTo: dateTo,
    reportPeriod: reportPeriod,
    generatedAt: new Date().toISOString(),
    markdownContent: markdown
  },
  binary: {
    data: {
      data: base64Content,
      mimeType: 'text/markdown',
      fileName: filename,
      fileExtension: 'md'
    }
  }
};
```

---

## 3. Google Drive Node

No code changes needed - it already uses `={{ $json.filename }}` which will automatically pick up the new filename format.

---

## 4. Send Report (Email) Node

Update the following fields:

### Subject Field:
```
=SEO Performance Report - {{ $('Convert To Markdown').first().json.targetWebsite }} ({{ $('Convert To Markdown').first().json.dateFrom }} to {{ $('Convert To Markdown').first().json.dateTo }})
```

### HTML Body:
```html
=<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
    .container { max-width: 600px; margin: 0 auto; padding: 20px; }
    .header { background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; text-align: center; }
    .content { background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px; }
    .button { display: inline-block; background: #2b6cb0; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; margin: 20px 0; }
    .footer { text-align: center; margin-top: 20px; color: #718096; font-size: 12px; }
    .highlight { background: #ebf8ff; padding: 15px; border-radius: 5px; border-left: 4px solid #2b6cb0; margin: 15px 0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸ“Š SEO Performance Report Ready!</h1>
    </div>
    <div class="content">
      <p>Hello,</p>
      
      <p>Your comprehensive SEO Performance Report has been generated and saved.</p>
      
      <div class="highlight">
        <h3 style="margin-top: 0;">ðŸ“‹ Report Details:</h3>
        <ul style="margin-bottom: 0;">
          <li><strong>Website:</strong> {{ $('Convert To Markdown').first().json.targetWebsite }}</li>
          <li><strong>Period:</strong> {{ $('Convert To Markdown').first().json.dateFrom }} to {{ $('Convert To Markdown').first().json.dateTo }}</li>
          <li><strong>Generated:</strong> {{ $now.format('d MMMM yyyy') }}</li>
          <li><strong>File:</strong> {{ $('Convert To Markdown').first().json.filename }}</li>
        </ul>
      </div>
      
      <p style="text-align: center;">
        <a href="https://drive.google.com/file/d/{{ $('Google Drive').first().json.id }}/view" class="button">
          ðŸ“„ View Report in Google Drive
        </a>
      </p>
      
      <h3>ðŸ“ˆ What's Included:</h3>
      <ul>
        <li>Executive Summary & Overall Status</li>
        <li>Domain & Traffic Overview with Trends</li>
        <li>Organic Keyword Performance Analysis</li>
        <li>Technical SEO Health Assessment</li>
        <li>Backlink Profile Analysis</li>
        <li>Summary of Period Gains</li>
        <li>Strategic Recommendations</li>
      </ul>
      
      <p>This report covers the period from <strong>{{ $('Convert To Markdown').first().json.dateFrom }}</strong> to <strong>{{ $('Convert To Markdown').first().json.dateTo }}</strong>.</p>
    </div>
    <div class="footer">
      <p>This report was automatically generated by our SEO monitoring system.</p>
    </div>
  </div>
</body>
</html>
```

---

## 5. Sticky Note (Optional Update)

Update the curl examples to reflect the new report type:

```
Testing URL:
curl -X POST "https://n8n.programmx.com/webhook-test/ProgressReport" -H "Content-Type: application/json" -d "{\"target_url\":\"https://example.com/\",\"email\":\"your@email.com\",\"location\":\"United Kingdom\",\"report_type\":\"performance\",\"date_from\":\"2025-10-01\",\"date_to\":\"2026-01-07\"}"

Production URL:
curl -X POST "https://n8n.programmx.com/webhook/ProgressReport" -H "Content-Type: application/json" -d "{\"target_url\":\"https://example.com/\",\"email\":\"your@email.com\",\"location\":\"United Kingdom\",\"report_type\":\"performance\",\"date_from\":\"2025-10-01\",\"date_to\":\"2026-01-07\"}"
```

---

## Summary of Changes

| Node | Change |
|------|--------|
| **Generate Prompt** | Updated to use date range period instead of monthly, UK English, new report structure |
| **Convert To Markdown** | Updated filename format to include date range |
| **Google Drive** | No changes needed (uses dynamic filename) |
| **Send Report** | Updated subject line and email body to reflect period-based reporting |
| **Sticky Note** | Updated example curl commands |

